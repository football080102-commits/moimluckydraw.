<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì œì˜ ë°¤ í–‰ìš´ê¶Œ ì¶”ì²¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-blue: #00d2ff;
            --deep-blue: #0045ff;
            --gold: #ffd700;
            --dark-bg: #030816;
        }

        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at center, #0a1931 0%, #030816 100%);
            color: white; font-family: 'Pretendard', sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh;
        }

        /* ë°°ê²½ ë¯¸ì„¸ ì›€ì§ì„ ì¶”ê°€ */
        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.15; pointer-events: none;
        }

        .top-ui {
            position: absolute; top: 20px; width: 92%; display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        .main-title {
            position: absolute; top: 8%; font-size: 2.8rem; font-weight: 800;
            color: white; text-shadow: 0 0 15px var(--primary-blue); text-align: center; width: 100%; transition: opacity 0.5s;
        }

        #main-stage {
            position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 12vh;
        }

        #box {
            font-size: 140px; filter: drop-shadow(0 0 25px var(--deep-blue));
            cursor: pointer; z-index: 50;
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s; 
        }

        #popup-text {
            position: absolute; top: 42%; left: 50%; transform: translate(-50%, -50%);
            font-size: 8rem; font-weight: 900; color: white; text-shadow: 0 0 40px var(--primary-blue); opacity: 0; z-index: 5;
        }

        #result-card {
            display: none; position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            width: 450px; height: 600px; background: linear-gradient(145deg, #001f4d, #000);
            border: 3px solid var(--primary-blue); border-radius: 40px; box-shadow: 0 0 100px rgba(0, 210, 255, 0.6); z-index: 1000;
            flex-direction: column; justify-content: center; align-items: center;
        }

        #res-name { font-size: 5rem; font-weight: 900; color: white; margin: 20px 0; text-shadow: 0 0 20px var(--primary-blue); }

        #flash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; opacity: 0; pointer-events: none; z-index: 1500; 
        }

        .btn-main { background: var(--deep-blue); color: white; border: none; padding: 15px 45px; font-size: 1.4rem; border-radius: 50px; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        .btn-main:hover { transform: scale(1.05); background: var(--primary-blue); color: black; }

        @keyframes shake {
            0% { transform: rotate(0deg); } 25% { transform: rotate(-10deg); } 75% { transform: rotate(10deg); } 100% { transform: rotate(0deg); }
        }
    </style>
</head>
<body>

<div id="flash"></div>
<div class="main-title" id="title-text">êµì œì˜ ë°¤ í–‰ìš´ê¶Œ ì¶”ì²¨</div>

<div class="top-ui">
    <button onclick="resetData()" style="background:none; border:none; color:#555; cursor:pointer;">ì´ˆê¸°í™”</button>
    <div id="counter" style="color:var(--primary-blue); font-weight:bold; font-size:1.2rem;">ëŒ€ê¸°: 0ëª…</div>
</div>

<div id="main-stage">
    <div id="popup-text"></div>
    <div id="box" onclick="startDraw()">ğŸ</div>
    <button class="btn-main" id="open-btn" onclick="startDraw()">ì¶”ì²¨í•˜ê¸°</button>

    <div id="result-card">
        <div id="res-unit" style="color:var(--primary-blue); font-size: 1.6rem;"></div>
        <div id="res-grade" style="margin:15px 0; font-size: 2rem;"></div>
        <div id="res-name"></div>
        <div style="font-size:1.4rem; color:#aaa; margin-top: 10px;">ë‹¹ì²¨ì„ ì¶•í•˜í•©ë‹ˆë‹¤!</div>
        <button onclick="closeResult()" class="btn-main" style="font-size:1.2rem; padding:10px 40px;">í™•ì¸</button>
    </div>
</div>

<script>
    const rawData = [
        { "grade": 6, "class": 1, "name": "ê¹€ì§€ì„±" }, { "grade": 4, "class": 1, "name": "ê¹€ìŠ¹í•˜" }, { "grade": 4, "class": 1, "name": "ê¹€ìœ í•˜" }, { "grade": 4, "class": 1, "name": "ë°•íš¨ì§„" },
        { "grade": 3, "class": 1, "name": "ê¹€ë‹¨ë¹„" }, { "grade": 3, "class": 1, "name": "ê¹€íƒœê±´" }, { "grade": 3, "class": 1, "name": "ì •ìœ¤ì„œ" }, { "grade": 2, "class": 1, "name": "ê¹€ìœ¤ì„œ" },
        { "grade": 2, "class": 1, "name": "ë°°ê²½ì€" }, { "grade": 2, "class": 1, "name": "ìµœì‹œì›" }, { "grade": 2, "class": 1, "name": "ì¥ë„ì›" }, { "grade": 1, "class": 1, "name": "ê¶Œí˜œì•„" },
        { "grade": 1, "class": 1, "name": "ìœ ì±„ìœ¤" }, { "grade": 1, "class": 1, "name": "ìœ¤ì†Œëª…" }, { "grade": 1, "class": 1, "name": "ì´ì§„ì„œ" }, { "grade": 1, "class": 1, "name": "ì„ì±„í•˜" },
        { "grade": 1, "class": 1, "name": "ì •ì§„ì£¼" }, { "grade": 6, "class": 2, "name": "ê¹€ì¬í˜•" }, { "grade": 4, "class": 2, "name": "ê°•íš¨ë¹ˆ" }, { "grade": 4, "class": 2, "name": "ë¬¸ìœ ê±´" },
        { "grade": 4, "class": 2, "name": "ìœ¤ì†Œí˜„" }, { "grade": 2, "class": 2, "name": "ê¹€ì„œì§„" }, { "grade": 2, "class": 2, "name": "ë°•ìœ ë¹ˆ" }, { "grade": 1, "class": 2, "name": "ê³µì˜ˆì€" },
        { "grade": 1, "class": 2, "name": "ë¬¸ìŠ¹ìœ¤" }, { "grade": 1, "class": 2, "name": "ì„±í•˜ì—°" }, { "grade": 6, "class": 3, "name": "ê¹€ì£¼ì˜" }, { "grade": 6, "class": 3, "name": "ì´ì¤€ì—°" },
        { "grade": 4, "class": 3, "name": "ê°•ë¯¼í˜" }, { "grade": 4, "class": 3, "name": "ê¶Œì¤€ì˜" }, { "grade": 4, "class": 3, "name": "ì„±í˜¸ì—°" }, { "grade": 4, "class": 3, "name": "ì •ì§„ì–‘" },
        { "grade": 3, "class": 3, "name": "ì—„ë‹¤ì• " }, { "grade": 3, "class": 3, "name": "ì´ì‹œí˜„" }, { "grade": 2, "class": 3, "name": "ë°°ìœ ì°¬" }, { "grade": 2, "class": 3, "name": "ì„œí•˜ë¦°" },
        { "grade": 2, "class": 3, "name": "ë°•í•˜ì§„" }, { "grade": 1, "class": 3, "name": "ê°•ìˆ˜ì˜" }, { "grade": 1, "class": 3, "name": "ê¶Œì„œìœ¤" }, { "grade": 1, "class": 3, "name": "ê¹€ì§€ë¯¼" },
        { "grade": 1, "class": 3, "name": "ì‹¬ë¯¼í•˜" }, { "grade": 1, "class": 3, "name": "í•˜ì˜ì§„" }, { "grade": 4, "class": 4, "name": "ë¬¸ì„±ì›" }, { "grade": 4, "class": 4, "name": "ì†ìŠ¹í˜„" },
        { "grade": 4, "class": 4, "name": "ì„íš¨ë¦°" }, { "grade": 3, "class": 4, "name": "ì–‘ìœ¤ìŠ¬" }, { "grade": 3, "class": 4, "name": "ì´ì„œë¦°" }, { "grade": 3, "class": 4, "name": "ì±„ì¤€í•˜" },
        { "grade": 2, "class": 4, "name": "ê¹€ìŠ¹ì£¼" }, { "grade": 2, "class": 4, "name": "ì •ì„¸ì–‘" }, { "grade": 2, "class": 4, "name": "ì‹ ì„œì•„" }, { "grade": 2, "class": 4, "name": "ì •ì‹œí™˜" },
        { "grade": 1, "class": 4, "name": "ê¶Œì˜ˆì€" }, { "grade": 1, "class": 4, "name": "ê¹€ê°€ì„" }, { "grade": 1, "class": 4, "name": "ì„œí•˜ì§„" }, { "grade": 1, "class": 4, "name": "ì†ì£¼ì€" },
        { "grade": 1, "class": 4, "name": "ì´ë¡œíœ˜" }
    ];

    let participants = [...rawData];
    const sndDrum = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
    const sndFirework = new Audio('https://assets.mixkit.co/active_storage/sfx/1500/1500-preview.mp3');

    function getGradeName(g) { return g <= 3 ? `ì¤‘${g}` : `ê³ ${g-3}`; }
    function updateCounter() { document.getElementById('counter').innerText = `ëŒ€ê¸°: ${participants.length}ëª…`; }
    updateCounter();

    function startDraw() {
        if (participants.length === 0) return alert("ì¶”ì²¨ ì™„ë£Œ!");
        if (document.getElementById('result-card').style.display === 'flex') return;

        // ì‚¬ìš´ë“œ ì‹œì‘
        sndDrum.loop = true;
        sndDrum.currentTime = 0;
        sndDrum.play();

        document.getElementById('open-btn').style.visibility = 'hidden';
        document.getElementById('title-text').style.opacity = '0.2';

        const winner = participants.splice(Math.floor(Math.random() * participants.length), 1)[0];
        
        const box = document.getElementById('box');
        box.style.animation = "shake 0.3s infinite"; 

        // ì‹œê°„ ë‹¨ì¶• (ì´ ì•½ 6ì´ˆ ì†Œìš”)
        setTimeout(() => showStep(`${winner.class}ë¶„ì„`), 800);
        setTimeout(() => showStep(getGradeName(winner.grade)), 2600);

        setTimeout(() => {
            box.style.animation = "none"; 
            setTimeout(() => {
                box.style.transform = "translateY(-15vh) scale(2.2)"; 
                
                setTimeout(() => {
                    const flash = document.getElementById('flash');
                    flash.style.opacity = "1"; 
                    
                    // ì‚¬ìš´ë“œ êµì²´
                    sndDrum.pause();
                    sndFirework.currentTime = 0;
                    sndFirework.play();

                    setTimeout(() => {
                        flash.style.opacity = "0";
                        box.style.opacity = "0";
                        showResult(winner);
                    }, 300);
                }, 1500); 
            }, 50);
        }, 4200);
    }

    function showStep(text) {
        const el = document.getElementById('popup-text');
        el.innerText = text;
        el.animate([
            {transform:'translate(-50%, 20%)', opacity:0}, 
            {transform:'translate(-50%, -50%)', opacity:1, offset:0.2}, 
            {transform:'translate(-50%, -120%)', opacity:0}
        ], {duration: 2000, fill: 'forwards'});
    }

    function showResult(winner) {
        const card = document.getElementById('result-card');
        document.getElementById('res-unit').innerText = `${winner.class}ë¶„ì„`;
        document.getElementById('res-grade').innerText = getGradeName(winner.grade);
        document.getElementById('res-name').innerText = winner.name;
        card.style.display = 'flex';
        
        // ì–‘ì˜† ìŒí­ì£½ ì—°ì¶œ
        confetti({ particleCount: 150, angle: 60, spread: 70, origin: { x: 0, y: 0.8 } });
        confetti({ particleCount: 150, angle: 120, spread: 70, origin: { x: 1, y: 0.8 } });
    }

    function closeResult() {
        document.getElementById('result-card').style.display = 'none';
        document.getElementById('open-btn').style.visibility = 'visible';
        document.getElementById('title-text').style.opacity = '1';
        const box = document.getElementById('box');
        box.style.transform = "scale(1)"; 
        box.style.opacity = "1";
        updateCounter();
    }

    function resetData() { if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) location.reload(); }
</script>
</body>
</html>
