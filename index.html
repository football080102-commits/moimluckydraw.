<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì œì˜ ë°¤ í–‰ìš´ê¶Œ ì¶”ì²¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-blue: #00d2ff;
            --deep-blue: #0045ff;
            --gold: #ffd700;
            --dark-bg: #030816;
        }

        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at center, #0a1931 0%, #030816 100%);
            color: white;
            font-family: 'Pretendard', sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        /* ìƒë‹¨ UI ë³µêµ¬ */
        .top-ui {
            position: absolute; top: 20px; width: 92%;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        .main-title {
            position: absolute; top: 8%;
            font-size: 2.8rem; font-weight: 800;
            color: white; text-shadow: 0 0 15px var(--primary-blue);
            text-align: center; width: 100%; transition: opacity 1s;
        }

        #main-stage {
            position: relative; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: flex-end; align-items: center;
            padding-bottom: 12vh; /* ìƒì í•˜ë‹¨ ë°°ì¹˜ */
        }

        /* ìƒì: ì ì  ì»¤ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ (íšŒì „ ì œê±°) */
        #box {
            font-size: 140px; filter: drop-shadow(0 0 25px var(--deep-blue));
            cursor: pointer; z-index: 50;
            transition: transform 2s ease-out, opacity 0.5s; /* 2ì´ˆ ë™ì•ˆ ë¶€ë“œëŸ½ê²Œ ë³€í™” */
        }

        #popup-text {
            position: absolute; top: 42%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem; font-weight: 900;
            color: white; text-shadow: 0 0 30px var(--primary-blue);
            opacity: 0; pointer-events: none; z-index: 5;
        }

        /* ê²°ê³¼ ì¹´ë“œ */
        #result-card {
            display: none; position: absolute; top: 45%; left: 50%;
            transform: translate(-50%, -50%);
            width: 400px; height: 550px;
            background: linear-gradient(145deg, #001f4d, #000);
            border: 2px solid var(--primary-blue); border-radius: 40px;
            box-shadow: 0 0 100px rgba(0, 210, 255, 0.6);
            z-index: 1000; flex-direction: column; justify-content: center; align-items: center;
        }

        #res-name { font-size: 4rem; font-weight: 900; color: white; margin: 20px 0; }

        /* í¬í† ë¶€ìŠ¤ UI ë³µêµ¬ */
        #photo-booth {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 2000; flex-direction: row;
        }
        .photo-slot { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #222; }
        
        .garland-modern {
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            width: 80%; display: flex; justify-content: center; align-items: center;
            gap: 30px; border-top: 1px solid var(--primary-blue); border-bottom: 1px solid var(--primary-blue);
            padding: 20px 0; background: rgba(0, 210, 255, 0.05);
        }

        #flash { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: radial-gradient(circle, white 0%, transparent 70%); 
            opacity: 0; pointer-events: none; z-index: 1500; 
        }

        .btn-main {
            background: var(--deep-blue); color: white; border: none; padding: 15px 45px;
            font-size: 1.4rem; border-radius: 50px; cursor: pointer; margin-top: 25px;
        }
    </style>
</head>
<body>

<div id="flash"></div>
<div class="main-title" id="title-text">êµì œì˜ ë°¤ í–‰ìš´ê¶Œ ì¶”ì²¨</div>

<div class="top-ui">
    <button onclick="resetData()" style="background:none; border:none; color:#555; cursor:pointer;">ì´ˆê¸°í™”</button>
    <div id="counter" style="color:var(--primary-blue); font-weight:bold; font-size:1.2rem;">ëŒ€ê¸°: 0ëª…</div>
    <button id="booth-btn" style="display:none; background:var(--primary-blue); color:black; border:none; border-radius:5px; font-weight:bold; padding:10px 20px; cursor:pointer;" onclick="showPhotoBooth()">ğŸ“¸ í¬í† ë¶€ìŠ¤</button>
</div>

<div id="main-stage">
    <div id="popup-text"></div>
    <div id="box" onclick="startDraw()">ğŸ</div>
    <button class="btn-main" id="open-btn" onclick="startDraw()">ì¶”ì²¨í•˜ê¸°</button>

    <div id="result-card">
        <div id="res-unit" style="color:var(--primary-blue); font-size: 1.4rem;"></div>
        <div id="res-grade" style="margin:15px 0; font-size: 1.8rem;"></div>
        <div id="res-name"></div>
        <div style="font-size:1.3rem; color:#aaa; margin-top: 10px;">ë‹¹ì²¨ì„ ì¶•í•˜í•©ë‹ˆë‹¤!</div>
        <button onclick="closeResult()" class="btn-main" style="font-size:1.1rem; padding:10px 30px;">í™•ì¸</button>
    </div>
</div>

<div id="photo-booth">
    <div class="garland-modern">
        <span>âœ¨</span><div style="font-size:2.5rem; font-weight:800; letter-spacing:15px; color:var(--primary-blue);">ì¶•í•˜í•©ë‹ˆë‹¤</div><span>âœ¨</span>
    </div>
    <div class="photo-slot" id="slot-0"></div>
    <div class="photo-slot" id="slot-1"></div>
    <div class="photo-slot" id="slot-2"></div>
    <button onclick="hidePhotoBooth()" class="btn-main" style="position:absolute; bottom:60px; left:50%; transform:translateX(-50%); background:white; color:black; font-weight:bold;">ëŒì•„ê°€ê¸°</button>
</div>

<script>
    const rawData = [
        { "grade": 6, "class": 1, "name": "ê¹€ì§€ì„±" }, { "grade": 4, "class": 1, "name": "ê¹€ìŠ¹í•˜" }, { "grade": 4, "class": 1, "name": "ê¹€ìœ í•˜" }, { "grade": 4, "class": 1, "name": "ë°•íš¨ì§„" },
        { "grade": 3, "class": 1, "name": "ê¹€ë‹¨ë¹„" }, { "grade": 3, "class": 1, "name": "ê¹€íƒœê±´" }, { "grade": 3, "class": 1, "name": "ì •ìœ¤ì„œ" }, { "grade": 2, "class": 1, "name": "ê¹€ìœ¤ì„œ" },
        { "grade": 2, "class": 1, "name": "ë°°ê²½ì€" }, { "grade": 2, "class": 1, "name": "ìµœì‹œì›" }, { "grade": 2, "class": 1, "name": "ì¥ë„ì›" }, { "grade": 1, "class": 1, "name": "ê¶Œí˜œì•„" },
        { "grade": 1, "class": 1, "name": "ìœ ì±„ìœ¤" }, { "grade": 1, "class": 1, "name": "ìœ¤ì†Œëª…" }, { "grade": 1, "class": 1, "name": "ì´ì§„ì„œ" }, { "grade": 1, "class": 1, "name": "ì„ì±„í•˜" },
        { "grade": 1, "class": 1, "name": "ì •ì§„ì£¼" }, { "grade": 6, "class": 2, "name": "ê¹€ì¬í˜•" }, { "grade": 4, "class": 2, "name": "ê°•íš¨ë¹ˆ" }, { "grade": 4, "class": 2, "name": "ë¬¸ìœ ê±´" },
        { "grade": 4, "class": 2, "name": "ìœ¤ì†Œí˜„" }, { "grade": 2, "class": 2, "name": "ê¹€ì„œì§„" }, { "grade": 2, "class": 2, "name": "ë°•ìœ ë¹ˆ" }, { "grade": 1, "class": 2, "name": "ê³µì˜ˆì€" },
        { "grade": 1, "class": 2, "name": "ë¬¸ìŠ¹ìœ¤" }, { "grade": 1, "class": 2, "name": "ì„±í•˜ì—°" }, { "grade": 6, "class": 3, "name": "ê¹€ì£¼ì˜" }, { "grade": 6, "class": 3, "name": "ì´ì¤€ì—°" },
        { "grade": 4, "class": 3, "name": "ê°•ë¯¼í˜" }, { "grade": 4, "class": 3, "name": "ê¶Œì¤€ì˜" }, { "grade": 4, "class": 3, "name": "ì„±í˜¸ì—°" }, { "grade": 4, "class": 3, "name": "ì •ì§„ì–‘" },
        { "grade": 3, "class": 3, "name": "ì—„ë‹¤ì• " }, { "grade": 3, "class": 3, "name": "ì´ì‹œí˜„" }, { "grade": 2, "class": 3, "name": "ë°°ìœ ì°¬" }, { "grade": 2, "class": 3, "name": "ì„œí•˜ë¦°" },
        { "grade": 2, "class": 3, "name": "ë°•í•˜ì§„" }, { "grade": 1, "class": 3, "name": "ê°•ìˆ˜ì˜" }, { "grade": 1, "class": 3, "name": "ê¶Œì„œìœ¤" }, { "grade": 1, "class": 3, "name": "ê¹€ì§€ë¯¼" },
        { "grade": 1, "class": 3, "name": "ì‹¬ë¯¼í•˜" }, { "grade": 1, "class": 3, "name": "í•˜ì˜ì§„" }, { "grade": 4, "class": 4, "name": "ë¬¸ì„±ì›" }, { "grade": 4, "class": 4, "name": "ì†ìŠ¹í˜„" },
        { "grade": 4, "class": 4, "name": "ì„íš¨ë¦°" }, { "grade": 3, "class": 4, "name": "ì–‘ìœ¤ìŠ¬" }, { "grade": 3, "class": 4, "name": "ì´ì„œë¦°" }, { "grade": 3, "class": 4, "name": "ì±„ì¤€í•˜" },
        { "grade": 2, "class": 4, "name": "ê¹€ìŠ¹ì£¼" }, { "grade": 2, "class": 4, "name": "ì •ì„¸ì–‘" }, { "grade": 2, "class": 4, "name": "ì‹ ì„œì•„" }, { "grade": 2, "class": 4, "name": "ì •ì‹œí™˜" },
        { "grade": 1, "class": 4, "name": "ê¶Œì˜ˆì€" }, { "grade": 1, "class": 4, "name": "ê¹€ê°€ì„" }, { "grade": 1, "class": 4, "name": "ì„œí•˜ì§„" }, { "grade": 1, "class": 4, "name": "ì†ì£¼ì€" },
        { "grade": 1, "class": 4, "name": "ì´ë¡œíœ˜" }
    ];

    let participants = [...rawData];
    let history = [];

    function getGradeName(g) { return g <= 3 ? `ì¤‘${g}` : `ê³ ${g-3}`; }
    function updateCounter() { document.getElementById('counter').innerText = `ëŒ€ê¸°: ${participants.length}ëª…`; }
    updateCounter();

    function startDraw() {
        if (participants.length === 0) return alert("ì¶”ì²¨ ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤!");
        document.getElementById('open-btn').style.visibility = 'hidden';
        document.getElementById('title-text').style.opacity = '0.2';

        const winner = participants.splice(Math.floor(Math.random() * participants.length), 1)[0];
        history.push(winner);
        updateCounter();

        const box = document.getElementById('box');
        box.style.animation = "shake 0.4s infinite"; 

        setTimeout(() => showStep(`${winner.class}ë¶„ì„`), 1200);
        setTimeout(() => showStep(getGradeName(winner.grade)), 3800);

        // ìƒì í”¼ë‚ ë ˆ: 2ì´ˆ ë™ì•ˆ ì ì§„ì ìœ¼ë¡œ 1/5 í¬ê¸°(scale 2.0)ë¡œ ì»¤ì§
        setTimeout(() => {
            box.style.animation = "none";
            box.style.transform = "translateY(-15vh) scale(2.0)"; // ì ì§„ì ìœ¼ë¡œ ì»¤ì§
            
            setTimeout(() => {
                const flash = document.getElementById('flash');
                flash.style.opacity = "1"; 
                setTimeout(() => {
                    flash.style.opacity = "0";
                    box.style.opacity = "0";
                    showResult(winner);
                }, 400);
            }, 2000); // 2ì´ˆ ëŒ€ê¸° í›„ ì„¬ê´‘
        }, 5500);
    }

    function showStep(text) {
        const el = document.getElementById('popup-text');
        el.innerText = text;
        el.animate([{transform:'translate(-50%, 40%)', opacity:0}, {transform:'translate(-50%, -50%)', opacity:1, offset:0.3}, {transform:'translate(-50%, -140%)', opacity:0}], {duration: 2500, fill: 'forwards'});
    }

    function showResult(winner) {
        const card = document.getElementById('result-card');
        document.getElementById('res-unit').innerText = `${winner.class}ë¶„ì„`;
        document.getElementById('res-grade').innerText = getGradeName(winner.grade);
        document.getElementById('res-name').innerText = winner.name;
        card.style.display = 'flex';
        confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 }, colors: ['#00d2ff', '#ffffff'] });
        if (history.length % 3 === 0) document.getElementById('booth-btn').style.display = 'block';
    }

    function closeResult() {
        document.getElementById('result-card').style.display = 'none';
        document.getElementById('open-btn').style.visibility = 'visible';
        document.getElementById('title-text').style.opacity = '1';
        const box = document.getElementById('box');
        box.style.transform = "scale(1)"; box.style.opacity = "1";
    }

    function showPhotoBooth() {
        const booth = document.getElementById('photo-booth');
        history.slice(-3).forEach((p, i) => {
            document.getElementById(`slot-${i}`).innerHTML = `
                <div style="color:var(--primary-blue); font-size:1.8rem;">${getGradeName(p.grade)}</div>
                <div style="font-size:5rem; font-weight:bold; margin:20px 0;">${p.name}</div>
                <div style="font-size:1.4rem; color:#888;">${p.class}ë¶„ì„</div>
            `;
        });
        booth.style.display = 'flex';
    }

    function hidePhotoBooth() { document.getElementById('photo-booth').style.display = 'none'; document.getElementById('booth-btn').style.display = 'none'; }
    function resetData() { if(confirm("ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload(); }
</script>

<style>
    @keyframes shake {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(-8deg); }
        75% { transform: rotate(8deg); }
        100% { transform: rotate(0deg); }
    }
</style>
</body>
</html>
