<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì œì˜ ë°¤ í–‰ìš´ê¶Œ ì¶”ì²¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-blue: #00d2ff;
            --deep-blue: #0045ff;
            --dark-bg: #030816;
            --gold: #ffd700;
        }

        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at center, #0a1931 0%, #030816 100%);
            color: white; font-family: 'Pretendard', sans-serif;
            margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; height: 100vh;
        }

        /* ë©”ì¸ UI */
        .top-ui { position: absolute; top: 20px; width: 92%; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .main-title { position: absolute; top: 8%; font-size: 2.8rem; font-weight: 800; text-shadow: 0 0 15px var(--primary-blue); transition: opacity 0.5s; }

        #main-stage { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 15vh; }

        #box { font-size: 150px; cursor: pointer; z-index: 50; filter: drop-shadow(0 0 20px var(--deep-blue)); transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s; }

        /* ì„¬ê´‘ íš¨ê³¼: ë¶€ë¶„ì ìœ¼ë¡œ ì•½í•˜ê²Œ */
        #flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0) 70%); opacity: 0; pointer-events: none; z-index: 1500; }

        /* ê²°ê³¼ ì¹´ë“œ */
        #result-card {
            display: none; position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            width: 480px; height: 550px; background: linear-gradient(145deg, #001f4d, #000);
            border: 3px solid var(--primary-blue); border-radius: 40px; box-shadow: 0 0 100px rgba(0, 210, 255, 0.6); z-index: 1000;
            flex-direction: column; justify-content: center; align-items: center;
        }

        /* â˜… í¬í† ë¶€ìŠ¤(3ë¶„í•  ëª…ë‹¨) ìŠ¤íƒ€ì¼ â˜… */
        #photo-booth {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 2000; flex-direction: column; align-items: center;
        }

        .garland { font-size: 3rem; margin-top: 50px; color: var(--gold); text-shadow: 0 0 20px var(--gold); font-weight: 900; }

        .winner-grid {
            display: flex; width: 90%; height: 60%; margin-top: 50px; gap: 20px;
        }

        .winner-slot {
            flex: 1; background: rgba(255,255,255,0.05); border: 2px solid var(--primary-blue);
            border-radius: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: inset 0 0 30px rgba(0, 210, 255, 0.2);
        }

        .slot-name { font-size: 4rem; font-weight: 900; margin: 20px 0; }
        .slot-info { font-size: 1.5rem; color: var(--primary-blue); }

        /* ìš°ì¸¡ ìƒë‹¨ í¬í† ë¶€ìŠ¤ ë²„íŠ¼ */
        #booth-open-btn {
            position: fixed; top: 20px; right: 20px; display: none;
            background: var(--gold); color: black; border: none; padding: 10px 20px;
            font-weight: bold; border-radius: 10px; cursor: pointer; z-index: 500;
        }

        /* ë²„íŠ¼ë“¤ */
        .btn-main { background: var(--deep-blue); color: white; border: none; padding: 15px 50px; font-size: 1.5rem; border-radius: 50px; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        
        #popup-text { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); font-size: 9rem; font-weight: 900; color: white; opacity: 0; z-index: 5; }

        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(-12deg); } 75% { transform: rotate(12deg); } 100% { transform: rotate(0deg); } }
    </style>
</head>
<body>

<div id="flash"></div>
<button id="booth-open-btn" onclick="openBooth()">ğŸ“¸ í¬í† ë¶€ìŠ¤ ë³´ê¸°</button>

<div class="top-ui">
    <button onclick="resetData()" style="background:none; border:none; color:#444; cursor:pointer;">ë°ì´í„° ì´ˆê¸°í™”</button>
    <div id="counter" style="color:var(--primary-blue); font-weight:bold; font-size:1.4rem;">ëŒ€ê¸°: 0ëª…</div>
</div>

<div id="main-stage">
    <div id="popup-text"></div>
    <div id="box" onclick="startDraw()">ğŸ</div>
    <button class="btn-main" id="open-btn" onclick="startDraw()">ì¶”ì²¨ ì‹œì‘!</button>

    <div id="result-card">
        <div id="res-unit" style="color:var(--primary-blue); font-size: 1.8rem;"></div>
        <div id="res-grade" style="margin:15px 0; font-size: 2.2rem;"></div>
        <div id="res-name" style="font-size: 5.5rem; font-weight: 900;"></div>
        <button onclick="closeResult()" class="btn-main">í™•ì¸</button>
    </div>
</div>

<div id="photo-booth">
    <div class="garland">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì²¨ì ëª…ë‹¨ ğŸ‰</div>
    <div class="winner-grid" id="winner-grid">
        </div>
    <button class="btn-main" onclick="closeBooth()" style="margin-top: 50px; background: #444;">ì¶”ì²¨ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<script>
    const rawData = [{"grade":6,"class":1,"name":"ê¹€ì§€ì„±"},{"grade":4,"class":1,"name":"ê¹€ìŠ¹í•˜"},{"grade":4,"class":1,"name":"ê¹€ìœ í•˜"},{"grade":4,"class":1,"name":"ë°•íš¨ì§„"},{"grade":3,"class":1,"name":"ê¹€ë‹¨ë¹„"},
                     {"grade":3,"class":1,"name":"ê¹€íƒœê±´"},{"grade":3,"class":1,"name":"ì •ìœ¤ì„œ"},{"grade":2,"class":1,"name":"ê¹€ìœ¤ì„œ"},{"grade":2,"class":1,"name":"ë°°ê²½ì€"},{"grade":2,"class":1,"name":"ìµœì‹œì›"},
                     {"grade":2,"class":1,"name":"ì¥ë„ì›"},{"grade":1,"class":1,"name":"ê¶Œí˜œì•„"},{"grade":1,"class":1,"name":"ìœ ì±„ìœ¤"},{"grade":1,"class":1,"name":"ìœ¤ì†Œëª…"},{"grade":1,"class":1,"name":"ì´ì§„ì„œ"},
                     {"grade":1,"class":1,"name":"ì„ì±„í•˜"},{"grade":1,"class":1,"name":"ì •ì§„ì£¼"},{"grade":6,"class":2,"name":"ê¹€ì¬í˜•"},{"grade":4,"class":2,"name":"ê°•íš¨ë¹ˆ"},{"grade":4,"class":2,"name":"ë¬¸ìœ ê±´"},
                     {"grade":4,"class":2,"name":"ìœ¤ì†Œí˜„"},{"grade":2,"class":2,"name":"ê¹€ì„œì§„"},{"grade":2,"class":2,"name":"ë°•ìœ ë¹ˆ"},{"grade":1,"class":2,"name":"ê³µì˜ˆì€"},{"grade":1,"class":2,"name":"ë¬¸ìŠ¹ìœ¤"},
                     {"grade":1,"class":2,"name":"ì„±í•˜ì—°"},{"grade":6,"class":3,"name":"ê¹€ì£¼ì˜"},{"grade":6,"class":3,"name":"ì´ì¤€ì—°"},{"grade":4,"class":3,"name":"ê°•ë¯¼í˜"},{"grade":4,"class":3,"name":"ê¶Œì¤€ì˜"},
                     {"grade":4,"class":3,"name":"ì„±í˜¸ì—°"},{"grade":4,"class":3,"name":"ì •ì§„ì–‘"},{"grade":3,"class":3,"name":"ì—„ë‹¤ì• "},{"grade":3,"class":3,"name":"ì´ì‹œí˜„"},{"grade":2,"class":3,"name":"ë°°ìœ ì°¬"},
                     {"grade":2,"class":3,"name":"ì„œí•˜ë¦°"},{"grade":2,"class":3,"name":"ë°•í•˜ì§„"},{"grade":1,"class":3,"name":"ê°•ìˆ˜ì˜"},{"grade":1,"class":3,"name":"ê¶Œì„œìœ¤"},{"grade":1,"class":3,"name":"ê¹€ì§€ë¯¼"},
                     {"grade":1,"class":3,"name":"ì‹¬ë¯¼í•˜"},{"grade":1,"class":3,"name":"í•˜ì˜ì§„"},{"grade":4,"class":4,"name":"ë¬¸ì„±ì›"},{"grade":4,"class":4,"name":"ì†ìŠ¹í˜„"},{"grade":4,"class":4,"name":"ì„íš¨ë¦°"},
                     {"grade":3,"class":4,"name":"ì–‘ìœ¤ìŠ¬"},{"grade":3,"class":4,"name":"ì´ì„œë¦°"},{"grade":3,"class":4,"name":"ì±„ì¤€í•˜"},{"grade":2,"class":4,"name":"ê¹€ìŠ¹ì£¼"},{"grade":2,"class":4,"name":"ì •ì„¸ì–‘"},
                     {"grade":2,"class":4,"name":"ì‹ ì„œì•„"},{"grade":2,"class":4,"name":"ì •ì‹œí™˜"},{"grade":1,"class":4,"name":"ê¶Œì˜ˆì€"},{"grade":1,"class":4,"name":"ê¹€ê°€ì„"},{"grade":1,"class":4,"name":"ì„œí•˜ì§„"},
                     {"grade":1,"class":4,"name":"ì†ì£¼ì€"},{"grade":1,"class":4,"name":"ì´ë¡œíœ˜"}]


    let participants = [...rawData];
    let recentWinners = []; // ìµœê·¼ ë‹¹ì²¨ì 3ëª…ì„ ì €ì¥
    
    const sndDrum = new Audio('drum.mp3');
    const sndFanfare = new Audio('fanfare.mp3');

    function getGradeName(g) { return g <= 3 ? `ì¤‘${g}` : `ê³ ${g-3}`; }
    function updateCounter() { document.getElementById('counter').innerText = `ëŒ€ê¸°: ${participants.length}ëª…`; }
    updateCounter();

    function startDraw() {
        if (participants.length === 0) return alert("ì¶”ì²¨ ì™„ë£Œ!");
        
        // 1ì´ˆ ë’¤ ë“œëŸ¼ ì†Œë¦¬ í•œ ë²ˆë§Œ
        setTimeout(() => { sndDrum.currentTime = 0; sndDrum.play(); }, 1000);

        document.getElementById('open-btn').style.visibility = 'hidden';
        const winner = participants.splice(Math.floor(Math.random() * participants.length), 1)[0];
        
        // ìµœê·¼ ë‹¹ì²¨ì ëª…ë‹¨ì— ì¶”ê°€ (ìµœëŒ€ 3ëª… ìœ ì§€)
        recentWinners.push(winner);
        if (recentWinners.length > 3) recentWinners.shift();

        const box = document.getElementById('box');
        box.style.animation = "shake 0.25s infinite"; 

        setTimeout(() => showStep(`${winner.class}ë¶„ì„`), 800);
        setTimeout(() => showStep(getGradeName(winner.grade)), 2300);

        setTimeout(() => {
            box.style.animation = "none"; 
            setTimeout(() => {
                box.style.transform = "translateY(-10vh) scale(2.0)"; 
                setTimeout(() => {
                    const flash = document.getElementById('flash');
                    flash.style.opacity = "0.5"; 
                    sndFanfare.play();
                    setTimeout(() => {
                        flash.style.opacity = "0";
                        box.style.opacity = "0";
                        showResult(winner);
                    }, 200);
                }, 1000); 
            }, 50);
        }, 4000);
    }

    function showStep(text) {
        const el = document.getElementById('popup-text');
        el.innerText = text;
        el.animate([
            {transform:'translate(-50%, 30%)', opacity:0}, 
            {transform:'translate(-50%, -50%)', opacity:1, offset:0.2}, 
            {transform:'translate(-50%, -130%)', opacity:0}
        ], {duration: 2500, fill: 'forwards'});
    }

    function showResult(winner) {
        document.getElementById('res-unit').innerText = `${winner.class}ë¶„ì„`;
        document.getElementById('res-grade').innerText = getGradeName(winner.grade);
        document.getElementById('res-name').innerText = winner.name;
        document.getElementById('result-card').style.display = 'flex';
        
        confetti({ particleCount: 150, angle: 60, spread: 80, origin: { x: 0, y: 0.8 } });
        confetti({ particleCount: 150, angle: 120, spread: 80, origin: { x: 1, y: 0.8 } });

        // 3ëª…ì´ ì±„ì›Œì§€ë©´ ìš°ì¸¡ ìƒë‹¨ ë²„íŠ¼ ë…¸ì¶œ
        if (recentWinners.length === 3) {
            document.getElementById('booth-open-btn').style.display = 'block';
        }
    }

    function openBooth() {
        const grid = document.getElementById('winner-grid');
        grid.innerHTML = ''; // ì´ˆê¸°í™”
        
        recentWinners.forEach(w => {
            const slot = document.createElement('div');
            slot.className = 'winner-slot';
            slot.innerHTML = `
                <div class="slot-info">${getGradeName(w.grade)} | ${w.class}ë¶„ì„</div>
                <div class="slot-name">${w.name}</div>
            `;
            grid.appendChild(slot);
        });

        document.getElementById('photo-booth').style.display = 'flex';
    }

    function closeBooth() {
        document.getElementById('photo-booth').style.display = 'none';
        // 3ëª…ì„ ë‹¤ í™•ì¸í–ˆìœ¼ë‹ˆ ëª…ë‹¨ ë¹„ìš°ê¸° (ìƒˆë¡œìš´ 3ëª…ì„ ìœ„í•´)
        recentWinners = [];
        document.getElementById('booth-open-btn').style.display = 'none';
    }

    function closeResult() {
        document.getElementById('result-card').style.display = 'none';
        document.getElementById('open-btn').style.visibility = 'visible';
        document.getElementById('box').style.transform = "scale(1)"; 
        document.getElementById('box').style.opacity = "1";
        updateCounter();
    }

    function resetData() { if(confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload(); }
</script>
</body>
</html>
